<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ultimate Control Panel</title>
    <script src="/socket.io/socket.io.js"></script>
    <style>
        body { background: #121212; color: #e0e0e0; font-family: 'Segoe UI', sans-serif; padding: 20px; display: flex; justify-content: center; }
        .panel { background: #1e1e1e; padding: 25px; border-radius: 12px; width: 100%; max-width: 500px; box-shadow: 0 4px 20px rgba(0,0,0,0.5); border: 1px solid #333; }
        
        h2 { color: #00eaff; margin-top: 0; border-bottom: 2px solid #333; padding-bottom: 10px; font-size: 18px; text-align: center; }
        .section-title { font-size: 12px; color: #888; text-transform: uppercase; letter-spacing: 1px; margin: 25px 0 10px 0; font-weight: bold; border-bottom: 1px solid #333; padding-bottom: 5px; }

        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª */
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px; }
        .stat-card { background: #252525; padding: 10px; border-radius: 8px; text-align: center; border: 1px solid #333; }
        .stat-val { font-size: 24px; font-weight: bold; color: white; }
        .stat-lbl { font-size: 11px; color: #aaa; }
        .record-lbl { font-size: 10px; color: #FFD700; margin-top: 5px; }
        #activeModeDisplay { text-align: center; color: #00eaff; font-weight: bold; margin-bottom: 10px; font-size: 14px; text-transform: uppercase; }

        /* Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„Ø£Ø·ÙˆØ§Ø± */
        .mode-row { display: flex; justify-content: space-between; align-items: center; background: #252525; margin-bottom: 5px; padding: 8px; border-radius: 5px; }
        .mode-name { font-weight: bold; width: 40px; }
        .mode-actions button { padding: 5px 10px; border: none; border-radius: 4px; cursor: pointer; font-size: 11px; font-weight: bold; margin-left: 5px; }
        .btn-set { background: #444; color: white; }
        .btn-set.active { background: #00eaff; color: black; }
        .btn-clr-score { background: #2a1a1a; color: #ff4444; border: 1px solid #ff4444; }
        .btn-clr-rank { background: #2a1a1a; color: #FFD700; border: 1px solid #FFD700; }

        /* Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø¹Ù†Ø§ØµØ± */
        .group { margin-bottom: 12px; display: flex; justify-content: space-between; align-items: center; }
        label { font-size: 13px; color: #ccc; }
        input, select { background: #333; border: 1px solid #444; color: white; padding: 6px; border-radius: 4px; }
        input[type="color"] { width: 40px; height: 30px; padding: 0; border: none; cursor: pointer; }
        input[type="number"] { width: 60px; }
        input[type="text"] { width: 120px; }
        
        .btn-save { background: #00eaff; color: #000; width: 100%; margin-top: 20px; padding: 12px; border: none; border-radius: 6px; font-weight: bold; cursor: pointer; }
        #status { text-align: center; margin-top: 15px; font-size: 12px; color: #666; }
    </style>
</head>
<body>
    <div class="panel">
        <h2>ğŸ›ï¸ COMMAND CENTER</h2>
        
        <div id="activeModeDisplay">ACTIVE: 1v1</div>

        <div class="stats-grid">
            <div class="stat-card" style="border-bottom: 3px solid #00eaff;">
                <div class="stat-lbl">CURRENT WIN</div><div class="stat-val" id="liveWin">0</div>
                <div class="record-lbl">ğŸ† Best: <span id="recWin">0</span></div>
            </div>
            <div class="stat-card" style="border-bottom: 3px solid #ff0055;">
                <div class="stat-lbl">CURRENT LOSS</div><div class="stat-val" id="liveLoss">0</div>
                <div class="record-lbl">ğŸ’€ Worst: <span id="recLoss">0</span></div>
            </div>
        </div>

        <div class="section-title">ğŸ› ï¸ Mode Manager</div>
        <div id="modesContainer">
            </div>

        <div class="section-title">ğŸ¨ Design & Style</div>
        <div class="group"><label>Win Text</label><input type="text" id="winText"></div>
        <div class="group"><label>Loss Text</label><input type="text" id="lossText"></div>
        <div class="group"><label>Win Color</label><input type="color" id="winColor"></div>
        <div class="group"><label>Loss Color</label><input type="color" id="lossColor"></div>
        <div class="group"><label>Background</label><input type="color" id="bgColor"></div>
        <div class="group"><label>Width / Height</label><span><input type="number" id="width"> <input type="number" id="height"></span></div>
        <div class="group"><label>Border / Radius</label><span><input type="number" id="borderWidth"> <input type="number" id="borderRadius"></span></div>
        <div class="group"><label>Shadow Opacity</label><input type="number" id="shadowOpacity" step="0.1" max="1"></div>
        <div class="group"><label>Layout</label>
            <select id="layout">
                <option value="row">Horizontal</option>
                <option value="column">Vertical</option>
                <option value="rtl">Arabic (RTL)</option>
            </select>
        </div>

        <button class="btn-save" onclick="saveSettings()">ğŸ’¾ SAVE CHANGES</button>
        <div id="status">Connecting...</div>
    </div>

    <script>
        const socket = io();
        const modes = ["1v1", "2v2", "3v3", "4v4"];
        let currentMode = "1v1";

        // Ø¨Ù†Ø§Ø¡ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø£Ø·ÙˆØ§Ø±
        function renderModes() {
            const container = document.getElementById('modesContainer');
            container.innerHTML = "";
            modes.forEach(mode => {
                const isActive = mode === currentMode;
                const html = `
                    <div class="mode-row">
                        <div class="mode-name" style="${isActive ? 'color:#00eaff':''}">${mode}</div>
                        <div class="mode-actions">
                            <button class="btn-set ${isActive ? 'active':''}" onclick="api('set_mode_${mode}')">ACTIVATE</button>
                            <button class="btn-clr-score" onclick="api('reset_score_${mode}')">0-0</button>
                            <button class="btn-clr-rank" onclick="api('reset_rank_${mode}')">ğŸ†0</button>
                        </div>
                    </div>
                `;
                container.innerHTML += html;
            });
        }

        socket.on('update_scores', (data) => {
            document.getElementById('liveWin').innerText = data.win;
            document.getElementById('liveLoss').innerText = data.loss;
            document.getElementById('recWin').innerText = data.rec_win;
            document.getElementById('recLoss').innerText = data.rec_loss;
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø·ÙˆØ± Ø§Ù„Ù†Ø´Ø·
            if(data.mode) {
                currentMode = data.mode;
                document.getElementById('activeModeDisplay').innerText = "ACTIVE: " + currentMode;
                renderModes(); // Ø¥Ø¹Ø§Ø¯Ø© Ø±Ø³Ù… Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ù„ÙˆØ§Ù†
            }
        });

        socket.on('update_settings', (s) => {
            setVal('winText', s.winText); setVal('lossText', s.lossText);
            setVal('winColor', s.winColor); setVal('lossColor', s.lossColor);
            setVal('bgColor', s.bgColor); setVal('width', s.width); setVal('height', s.height);
            setVal('borderWidth', s.borderWidth); setVal('borderRadius', s.borderRadius);
            setVal('shadowOpacity', s.shadowOpacity); setVal('layout', s.layout);
            document.getElementById('status').innerText = "âœ… Synced";
        });

        function saveSettings() {
            const s = {
                winText: getVal('winText'), lossText: getVal('lossText'),
                winColor: getVal('winColor'), lossColor: getVal('lossColor'), bgColor: getVal('bgColor'),
                labelColor: "#CCCCCC", numColor: "#FFFFFF",
                width: getVal('width'), height: getVal('height'), layout: getVal('layout'),
                borderWidth: getVal('borderWidth'), borderRadius: getVal('borderRadius'), shadowOpacity: getVal('shadowOpacity'),
                gap: 15, fontFamily: "'Cairo', sans-serif", labelSize: 30, numSize: 35 
            };
            socket.emit('save_settings', s);
            document.getElementById('status').innerText = "ğŸ’¾ Saved!";
        }

        function api(action) {
            let confirmMsg = "Confirm action?";
            if(action.includes("reset_score")) confirmMsg = "Reset score to 0-0 for this mode?";
            if(action.includes("reset_rank")) confirmMsg = "Reset RECORD/RANK for this mode?";
            
            if(!action.includes("set_mode")) { // Ù„Ø§ ØªØ·Ù„Ø¨ ØªØ£ÙƒÙŠØ¯ Ø¹Ù†Ø¯ Ø§Ù„ØªÙØ¹ÙŠÙ„ØŒ ÙÙ‚Ø· Ø¹Ù†Ø¯ Ø§Ù„ØªØµÙÙŠØ±
                if(!confirm(confirmMsg)) return;
            }
            fetch(`/api/set?action=${action}`);
        }

        function setVal(id, v) { if(document.getElementById(id)) document.getElementById(id).value = v; }
        function getVal(id) { return document.getElementById(id).value; }
        
        renderModes(); // ØªØ´ØºÙŠÙ„ Ø£ÙˆÙ„ÙŠ
    </script>
</body>
</html>
